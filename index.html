<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guerre froide : Opération Équilibre de la Terreur</title>
  <style>
    :root {
      --bg: #0b1623;
      --card: rgba(10, 18, 28, 0.78);
      --card2: rgba(10, 18, 28, 0.60);
      --text: #eef6ff;
      --muted: rgba(238, 246, 255, 0.80);
      --line: rgba(255,255,255,0.14);
      --good: #35d07f;
      --bad: #ff5c7a;
      --accent: #8fd3ff;
      --shadow: 0 18px 45px rgba(0,0,0,.45);
      --radius: 18px;
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: var(--font);
      color: var(--text);
      background: var(--bg);
    }

    body {
      background-image:
        linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.55)),
        url("arriere_plan_guerre_froide.png");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    .wrap {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: clamp(12px, 2.4vw, 24px);
    }

    .app {
      width: min(980px, 100%);
      backdrop-filter: blur(10px);
    }

    .topbar {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px 14px;
      box-shadow: var(--shadow);
    }

    .brand { display: flex; flex-direction: column; gap: 2px; min-width: 0; }
    .brand h1 { margin: 0; font-size: clamp(18px, 2.2vw, 22px); letter-spacing: .2px; line-height: 1.2; }
    .brand .sub { font-size: 13px; color: var(--muted); line-height: 1.25; }

    .controls { display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; }

    button {
      font-family: inherit;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor: pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover { background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.22); }
    button:active { transform: translateY(1px) scale(0.99); }
    button[disabled] { opacity: 0.55; cursor: not-allowed; }

    .btn-primary { background: rgba(143, 211, 255, 0.18); border-color: rgba(143, 211, 255, 0.35); }
    .btn-good { background: rgba(53, 208, 127, 0.16); border-color: rgba(53, 208, 127, 0.35); }

    .panel {
      margin-top: 12px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .panel-head {
      display: grid;
      gap: 10px;
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0));
    }

    .stats { display: grid; grid-template-columns: 1fr; gap: 10px; }
    .kpis { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

    .pill {
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.06);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 13px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      align-items: center;
      white-space: nowrap;
    }

    .dot { width: 9px; height: 9px; border-radius: 99px; background: var(--accent); box-shadow: 0 0 0 4px rgba(143,211,255,0.18); }
    .dot.good { background: var(--good); box-shadow: 0 0 0 4px rgba(53,208,127,0.18); }
    .dot.bad { background: var(--bad); box-shadow: 0 0 0 4px rgba(255,92,122,0.18); }

    .progress {
      display:flex;
      gap:4px;
      padding:4px;
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--line);
      border-radius: 999px;
      align-items:center;
    }
    .seg {
      flex: 1 1 0;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.10);
      transition: transform .12s ease, background .2s ease, border-color .2s ease;
    }
    .seg.current { transform: scaleY(1.25); border-color: rgba(143,211,255,0.45); }
    .seg.good { background: rgba(53,208,127,0.55); border-color: rgba(53,208,127,0.55); }
    .seg.bad { background: rgba(255,92,122,0.55); border-color: rgba(255,92,122,0.55); }

    .panel-body { padding: 14px; display: grid; gap: 12px; }
    .q-title { margin: 0; font-size: clamp(16px, 2.2vw, 20px); line-height: 1.35; }

    .choices { display: grid; gap: 10px; grid-template-columns: 1fr; }
    .choice {
      text-align: left;
      border-radius: 16px;
      padding: 12px 12px;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--line);
      position: relative;
    }
    .choice:hover { background: rgba(255,255,255,0.09); }
    .choice.correct { border-color: rgba(53,208,127,0.6); background: rgba(53,208,127,0.10); }
    .choice.wrong { border-color: rgba(255,92,122,0.55); background: rgba(255,92,122,0.08); }

    .choice .tag {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 12px;
      opacity: 0.9;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.18);
    }

    .feedback {
      border: 1px solid var(--line);
      background: var(--card2);
      border-radius: 16px;
      padding: 12px;
      line-height: 1.45;
    }
    .feedback.good { border-color: rgba(53,208,127,0.38); }
    .feedback.bad { border-color: rgba(255,92,122,0.38); }

    .info {
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px dashed rgba(143,211,255,0.45);
      background: rgba(143,211,255,0.08);
      color: var(--text);
    }

    .action-row {
      display: grid;
      gap: 10px;
      grid-template-columns: 1fr;
      margin-top: 6px;
    }
    .pass { order: -1; }

    .footer-note { color: var(--muted); font-size: 12.5px; line-height: 1.35; }

    .result { padding: 14px; display: none; }
    .result h2 { margin: 0 0 8px 0; font-size: 20px; }
    .result .summary { display: grid; gap: 10px; margin-bottom: 12px; }
    .badlist { display: grid; gap: 10px; margin-top: 10px; }

    details { border: 1px solid var(--line); background: rgba(255,255,255,0.05); border-radius: 16px; padding: 10px 12px; }
    summary { cursor: pointer; font-weight: 650; outline: none; }
    details p { margin: 8px 0 0 0; color: var(--muted); line-height: 1.45; }

    @media (min-width: 760px) {
      .stats { grid-template-columns: 1.2fr 1fr; align-items: center; }
      .choices { grid-template-columns: 1fr 1fr; }
      .action-row { grid-template-columns: 1fr 1fr; align-items: stretch; }
      .pass { order: 0; grid-column: 1 / span 2; }
    }

    .fs-fab {
      position: fixed;
      z-index: 50;
      right: 14px;
      bottom: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .fs-fab button {
      border-radius: 16px;
      padding: 12px 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      backdrop-filter: blur(8px);
    }

    .sr-only {
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }
  
    .sendbox{
      margin-top: 12px;
      border-top: 1px solid var(--line);
      padding-top: 10px;
    }
    .sendgrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .field{
      display:grid;
      gap:6px;
      font-size: 13px;
      color: var(--muted);
    }
    .field input{
      width: 100%;
      padding: 11px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      outline: none;
    }
    .field input:focus{
      border-color: rgba(143,211,255,0.55);
      box-shadow: 0 0 0 4px rgba(143,211,255,0.12);
    }
    @media (min-width: 760px){
      .sendgrid{ grid-template-columns: 1fr 1fr; }
    }

</style>
</head>
<body>
  <div class="wrap">
    <main class="app" id="app" aria-live="polite">
      <header class="topbar">
        <div class="brand">
          <h1>Guerre froide : Opération Équilibre de la Terreur</h1>
          <div class="sub">Univers social (Sec. 4) • Guerre froide • 4 choix • rétroactions + approfondissement</div>
        </div>
        <div class="controls">
          <button class="btn-primary" id="restartBtn" title="Recommencer">Recommencer</button>
          <button id="shuffleBtn" title="Mélanger l’ordre des questions (optionnel)">Mélanger</button>
        </div>
      </header>

      <section class="panel" id="quizPanel">
        <div class="panel-head">
          <div class="stats">
            <div class="kpis">
              <div class="pill" title="Question en cours"><span class="dot"></span><span><strong id="idxTxt">1</strong>/<span id="totalTxt">0</span></span></div>
              <div class="pill" title="Bonnes réponses (uniquement si réussi du premier coup)"><span class="dot good"></span><span>Bonnes réponses: <strong id="goodTxt">0</strong></span></div>
              <div class="pill" id="badPill" style="display:none;" title="Tentatives (comptées en coulisses)"><span class="dot bad"></span><span>Tentatives: <strong id="badTxt">0</strong></span></div>
            </div>
            <div>
              <div class="progress" aria-label="Progression" id="progressBar"></div>
              <div class="footer-note" style="margin-top:8px;">
                Le bouton <strong>Passer</strong> apparaît seulement après une bonne réponse.
                Les tentatives erronées sont comptées, mais ne sont pas affichées pendant le quiz.
              </div>
            </div>
          </div>
        </div>

        <div class="panel-body" id="panelBody">
          <h2 class="q-title" id="questionTxt">Chargement…</h2>
          <div class="choices" id="choices"></div>

          <div class="feedback" id="feedbackBox" style="display:none;"></div>
          <div class="info" id="infoBox" style="display:none;"></div>

          <div class="action-row">
            <button class="btn-good pass" id="passBtn" disabled style="display:none;">Passer ▶</button>
            <button class="btn-primary" id="hintBtn">Indice</button>
          </div>

          <div class="footer-note" id="hintText" style="display:none;"></div>
        </div>

        <div class="result" id="resultPanel">
          <h2>Résultats</h2>
          <div class="summary" id="summary"></div>
          
          <div class="badlist" id="badList"></div>

          <div class="sendbox" id="sendBox">
            <h3 style="margin:18px 0 8px 0;">Envoyer les résultats à mon enseignant</h3>
            <div class="footer-note" style="margin-bottom:10px;">
              Utilise ton <strong>code étudiant</strong> (pas ton nom). Les résultats seront envoyés automatiquement à l’enseignant.
            </div>

            <div class="sendgrid">
              <label class="field">
                <span>Code étudiant</span>
                <input id="studentCode" type="text" inputmode="text" autocomplete="off" placeholder="Ex. AB12345" />
              </label>
              <label class="field">
                <span>Courriel de l’enseignant</span>
                <input id="teacherEmail" type="email" inputmode="email" autocomplete="off" placeholder="enseignant@ecole.qc.ca" />
              </label>
              <label class="field" style="grid-column: 1 / -1;">
                <span>URL du service d’envoi (fourni par l’enseignant)</span>
                <input id="endpointUrl" type="url" inputmode="url" autocomplete="off" value="https://script.google.com/macros/s/AKfycbymkT-J7xxAbxWd2JfS2TwpRS37NIBte1xh38CK341nEFiR-kr5dwyWI_UprLasnsF2-w/exec" readonly />
              </label>
            </div>

            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
              <button class="btn-primary" id="sendBtn">Envoyer les résultats</button>
              <button id="copyReportBtn" title="Copier le rapport complet">Copier le rapport</button>
            </div>

            <div class="footer-note" id="sendStatus" style="margin-top:10px; display:none;"></div>
          </div>

        </div>
      </section>

      <div class="fs-fab" aria-label="Plein écran">
        <button id="enterFsBtn" class="btn-primary" title="Mode plein écran">⛶ Plein écran</button>
        <button id="exitFsBtn" style="display:none;" title="Quitter le plein écran">⤫ Quitter</button>
      </div>
    </main>
  </div>

<script>
  const ORIGINAL = [{"q": "Pourquoi parle-t-on de « guerre froide » pour décrire le conflit Est-Ouest après 1945?", "choices": ["Parce qu’il s’agit d’une guerre qui se déroule uniquement dans l’Arctique", "Parce que les deux superpuissances s’affrontent surtout sans combats directs entre elles, via tensions et conflits indirects", "Parce que l’ONU interdit toute guerre après 1945", "Parce que les armes nucléaires rendent la guerre impossible partout dans le monde"], "correct": 1, "fb": ["Non. L’Arctique est un enjeu important, mais ce n’est pas la raison du terme « froide ».", "✅ Oui. Les États-Unis et l’URSS évitent l’affrontement direct, mais se confrontent par alliances, propagande, course aux armements et guerres par procuration.", "Non. L’ONU n’a pas le pouvoir d’interdire toutes les guerres; plusieurs conflits éclatent malgré tout.", "Pas exactement. Les armes nucléaires créent une dissuasion, mais n’empêchent pas les conflits indirects (Corée, Vietnam, etc.)."], "info": "Après 1945, deux blocs s’opposent : le bloc de l’Ouest (mené par les États‑Unis, capitalisme et démocratie libérale) et le bloc de l’Est (mené par l’URSS, communisme). Le conflit est dit « froid » car il n’y a pas de guerre directe USA‑URSS, mais une confrontation permanente : propagande, espionnage, alliances militaires (OTAN, pacte de Varsovie), course aux armements et crises (Berlin, Cuba). La période est généralement datée de 1945 à 1991 (dissolution de l’URSS).", "hint": "Repère l’idée clé : « froid » ne veut pas dire absence de conflit, mais absence de guerre directe entre les deux superpuissances."}, {"q": "Quel événement marque le plus souvent le début symbolique de la guerre froide en Europe (1947-1949)?", "choices": ["La création de l’ONU (1945)", "Le blocus de Berlin et le pont aérien (1948-1949)", "La chute du mur de Berlin (1989)", "La guerre du Golfe (1990-1991)"], "correct": 1, "fb": ["Non. L’ONU naît après la Seconde Guerre mondiale, mais n’est pas l’événement clé du démarrage du conflit Est‑Ouest.", "✅ Oui. Le blocus de Berlin (1948) et le pont aérien illustrent la première grande crise Est‑Ouest en Europe.", "Non. C’est un moment majeur… mais il arrive à la fin de la guerre froide.", "Non. Ce conflit est lié à l’Irak et au Koweït; il n’est pas le point de départ de la guerre froide."], "info": "En 1948, les Soviétiques bloquent les accès terrestres vers Berlin-Ouest. Les Occidentaux organisent un immense pont aérien pour ravitailler la population. Cette crise accélère la division de l’Allemagne en deux États (RFA à l’Ouest, RDA à l’Est) et renforce la logique des blocs. Elle prépare aussi la création de l’OTAN (1949).", "hint": "Pense à la première grande crise qui montre la division concrète de l’Allemagne et de Berlin, avant même le mur."}, {"q": "Quel objectif vise principalement le plan Marshall (1947)?", "choices": ["Reconstruire l’Europe de l’Ouest et limiter l’influence communiste par l’aide économique", "Financer la conquête spatiale américaine", "Créer un gouvernement mondial unique", "Donner l’indépendance immédiate à toutes les colonies européennes"], "correct": 0, "fb": ["✅ Oui. L’aide économique américaine cherche à stabiliser l’Europe et à réduire l’attrait du communisme.", "Non. La course à l’espace devient un enjeu plus tard (années 1950-1960).", "Non. Ce n’est pas un projet de gouvernement mondial.", "Non. La décolonisation s’accélère après 1945, mais le plan Marshall ne vise pas cela."], "info": "Le plan Marshall (European Recovery Program) offre une aide massive aux pays d’Europe occidentale pour reconstruire après 1945. Il répond à une logique économique (relancer la production et le commerce) et politique (endiguer/« contenir » l’expansion communiste). L’URSS refuse l’aide et pousse plusieurs pays de l’Est à faire de même, renforçant la séparation des blocs.", "hint": "Demande-toi : l’aide américaine vise-t-elle d’abord l’économie ou l’espace? Et quel effet politique cela peut-il avoir?"}, {"q": "Quel organisme militaire, créé en 1949, regroupe plusieurs pays occidentaux et inclut le Canada?", "choices": ["Le pacte de Varsovie", "L’OTAN (Organisation du traité de l’Atlantique Nord)", "Le Kominform", "L’OPEP"], "correct": 1, "fb": ["Non. Le pacte de Varsovie (1955) est l’alliance militaire du bloc de l’Est.", "✅ Oui. Le Canada est membre fondateur de l’OTAN en 1949.", "Non. Le Kominform est un organisme de coordination communiste, pas une alliance militaire occidentale.", "Non. L’OPEP concerne le pétrole (1960), pas la guerre froide à ses débuts."], "info": "L’OTAN est fondée en 1949 sur le principe de défense collective : une attaque contre un membre est considérée comme une attaque contre tous. Le Canada y participe pour renforcer la sécurité en Atlantique Nord et soutenir les alliés occidentaux face à l’URSS.", "hint": "Indice : c’est une alliance militaire occidentale créée à la fin des années 1940; le Canada en fait partie dès le départ."}, {"q": "Quelle alliance militaire, fondée en 1955, répond à l’OTAN en regroupant des États du bloc de l’Est?", "choices": ["Le pacte de Varsovie", "La Société des Nations", "L’ALENA", "Le Commonwealth"], "correct": 0, "fb": ["✅ Oui. Le pacte de Varsovie est l’alliance militaire du bloc soviétique (1955).", "Non. La Société des Nations est l’ancêtre de l’ONU et disparaît après 1945.", "Non. L’ALENA est un accord économique (1994), bien plus tard.", "Non. Le Commonwealth est une organisation liée à l’ancien Empire britannique."], "info": "Le pacte de Varsovie (1955) formalise l’alliance militaire des pays communistes d’Europe de l’Est autour de l’URSS, en réaction au renforcement de l’OTAN et à l’intégration de l’Allemagne de l’Ouest dans le camp occidental.", "hint": "Indice : alliance du bloc de l’Est créée après l’OTAN, dans les années 1950."}, {"q": "Quel est le principal principe stratégique associé à la dissuasion nucléaire pendant la guerre froide?", "choices": ["La « guerre éclair »", "La destruction mutuelle assurée (équilibre de la terreur)", "La neutralité obligatoire", "La fin des armées régulières"], "correct": 1, "fb": ["Non. La « guerre éclair » renvoie surtout à des stratégies de la Seconde Guerre mondiale.", "✅ Oui. Si les deux camps peuvent se détruire, lancer une attaque devient trop risqué : la peur de la riposte dissuade.", "Non. Plusieurs pays sont neutres, mais ce n’est pas le principe de base de la dissuasion nucléaire.", "Non. Les armées demeurent; la course aux armements s’intensifie."], "info": "Avec des armes nucléaires capables de détruire des villes entières, les superpuissances cherchent à éviter une guerre directe. La logique de « destruction mutuelle assurée » (MAD) repose sur la capacité de riposte : si un camp attaque, l’autre peut répondre et causer des pertes catastrophiques. Cela n’empêche pas les conflits indirects.", "hint": "Pense à l’expression « équilibre de la terreur » : que se passe-t-il si un camp attaque en premier?"}, {"q": "Quel événement est associé à la construction du mur de Berlin (1961)?", "choices": ["La fermeture de la frontière entre Berlin-Est et Berlin-Ouest pour empêcher les départs vers l’Ouest", "Un traité de paix entre les deux Allemagne", "La création de l’Union européenne", "La fin officielle de la guerre froide"], "correct": 0, "fb": ["✅ Oui. Le mur vise surtout à stopper l’exode de la population de l’Est vers l’Ouest.", "Non. Le mur symbolise plutôt l’aggravation de la division.", "Non. L’UE se construit plus tard à partir des années 1950, mais ce n’est pas l’événement du mur.", "Non. La fin se situe plutôt vers 1989-1991."], "info": "Entre 1949 et 1961, des millions de personnes quittent la RDA vers la RFA, souvent via Berlin. En août 1961, la RDA, soutenue par l’URSS, érige un mur et renforce les contrôles. Le mur devient un symbole mondial de la division idéologique et politique entre les deux blocs.", "hint": "Rappelle-toi pourquoi tant de personnes quittaient l’Est pour l’Ouest via Berlin avant 1961."}, {"q": "La crise des missiles de Cuba (1962) oppose directement quels acteurs?", "choices": ["Le Canada et l’URSS", "Les États-Unis et l’URSS (à propos de missiles soviétiques à Cuba)", "La France et la Grande-Bretagne", "La Chine et le Japon"], "correct": 1, "fb": ["Non. Le Canada est impliqué dans l’environnement nord-américain, mais ce n’est pas l’affrontement principal.", "✅ Oui. L’installation de missiles soviétiques à Cuba provoque une crise majeure USA‑URSS en 1962.", "Non. Ce choix correspond plutôt à d’autres contextes (ex. Suez, 1956).", "Non. Ce n’est pas la crise des missiles."], "info": "En octobre 1962, les États-Unis découvrent des missiles soviétiques à Cuba. Kennedy impose un blocus naval (appelé « quarantaine »). Après des négociations tendues, l’URSS retire ses missiles en échange, notamment, d’engagements américains (dont le retrait de missiles en Turquie, de façon plus discrète) et d’une promesse de ne pas envahir Cuba. On considère souvent que le monde s’approche alors d’une guerre nucléaire.", "hint": "Indice : crise d’octobre 1962; missiles installés sur une île proche des États-Unis."}, {"q": "Quelle guerre est un exemple typique de « guerre par procuration » à laquelle le Canada participe sous l’ONU?", "choices": ["La guerre de Corée (1950-1953)", "La guerre de Trente Ans", "La guerre de Sécession", "La guerre de Crimée"], "correct": 0, "fb": ["✅ Oui. Le Canada envoie des troupes en Corée sous mandat de l’ONU, dans un contexte de rivalité Est‑Ouest.", "Non. Ce conflit est européen (XVIIe siècle).", "Non. C’est un conflit interne aux États-Unis (1861-1865).", "Non. C’est un conflit du XIXe siècle en Europe."], "info": "La guerre de Corée débute en 1950 lorsque la Corée du Nord (soutenue par le bloc communiste) envahit la Corée du Sud. L’ONU organise une intervention pour défendre le Sud. Le Canada contribue militairement à l’effort, ce qui illustre comment la guerre froide se manifeste par des conflits indirects plutôt que par un affrontement direct USA‑URSS.", "hint": "Indice : guerre en Asie où l’ONU intervient; le Canada envoie des troupes."}, {"q": "Quelle organisation de défense nord-américaine, créée en 1957-1958, coordonne la surveillance aérienne entre le Canada et les États-Unis?", "choices": ["NORAD", "OTAN", "ONU", "FMI"], "correct": 0, "fb": ["✅ Oui. NORAD coordonne la défense aérospatiale de l’Amérique du Nord (Canada–États-Unis).", "Non. L’OTAN est une alliance transatlantique plus large.", "Non. L’ONU n’est pas une organisation militaire de défense continentale.", "Non. Le FMI est une institution financière."], "info": "Le NORAD (North American Aerospace Defense Command) est créé pour détecter et suivre les menaces aériennes visant l’Amérique du Nord. Il s’inscrit dans la militarisation de la guerre froide et la coopération stratégique Canada–États‑Unis.", "hint": "Indice : organisation Canada–États-Unis liée à la surveillance du ciel nord-américain (menace de bombardiers/missiles)."}, {"q": "Pourquoi l’Arctique devient-il un enjeu stratégique majeur pendant la guerre froide pour le Canada?", "choices": ["Parce qu’il est la route la plus courte pour des bombardiers/missiles entre l’URSS et l’Amérique du Nord", "Parce que le Canada y découvre de l’or en 1946", "Parce que l’ONU y installe son siège", "Parce que l’URSS y interdit toute navigation"], "correct": 0, "fb": ["✅ Oui. La géographie de l’Arctique le rend central pour la défense et la souveraineté canadienne.", "Non. Des ressources existent, mais ce n’est pas l’enjeu principal ici.", "Non. Le siège de l’ONU est à New York.", "Non. Ce n’est pas l’explication de base."], "info": "Sur un globe, la route la plus courte entre l’URSS et l’Amérique du Nord passe près du pôle Nord. Pendant la guerre froide, le Canada renforce sa souveraineté et sa défense dans l’Arctique : stations radar, coopération avec les États-Unis et affirmation du contrôle du territoire.", "hint": "Pense à la géographie : sur un globe, quel passage est le plus court entre URSS et Amérique du Nord?"}, {"q": "Quel concept décrit la stratégie américaine visant à empêcher l’expansion du communisme après 1947?", "choices": ["La détente", "Le containment (endiguement)", "La perestroïka", "La neutralité"], "correct": 1, "fb": ["La détente correspond plutôt à une période d’apaisement relatif (années 1970).", "✅ Oui. L’endiguement vise à limiter l’expansion de l’influence soviétique/communiste.", "La perestroïka est une réforme soviétique associée à Gorbatchev (années 1980).", "La neutralité n’est pas la stratégie officielle des États-Unis."], "info": "Le « containment » (endiguement) devient un pilier de la politique étrangère américaine : soutenir des États menacés par le communisme (aide économique, alliances, interventions indirectes) afin d’empêcher l’URSS et ses alliés d’étendre leur influence.", "hint": "Indice : stratégie américaine formulée après 1947 pour « contenir » l’expansion communiste."}, {"q": "Quelle période correspond le mieux à la « détente » entre les deux blocs?", "choices": ["1945-1947", "Années 1970 (accords, dialogues et limitations d’armements)", "1995-2001", "1837-1838"], "correct": 1, "fb": ["Non. Les tensions montent plutôt après 1945.", "✅ Oui. La détente se situe surtout dans les années 1970 (accords, dialogues, canaux de communication).", "Non. Ce n’est pas une période classique de la guerre froide.", "Non. Ces dates renvoient aux rébellions au Bas-Canada/Haut-Canada."], "info": "La détente correspond à un apaisement relatif (sans disparition de la rivalité). On observe davantage de négociations et d’accords (limitation de certains armements, rapprochements diplomatiques). Elle est fragilisée par de nouvelles crises, dont l’Afghanistan (1979).", "hint": "Indice : période d’apaisement relatif surtout dans les années 1970, avec davantage de négociations."}, {"q": "Quelle intervention soviétique de 1979 contribue à la fin de la détente et à une reprise des tensions?", "choices": ["L’invasion de l’Afghanistan", "La nationalisation du canal de Suez", "La création de l’OTAN", "La signature du Traité de Rome"], "correct": 0, "fb": ["✅ Oui. L’intervention soviétique en Afghanistan (1979) ravive fortement les tensions.", "Non. La crise de Suez est en 1956 et implique surtout l’Égypte, Israël, la France et le Royaume-Uni.", "Non. L’OTAN date de 1949.", "Non. Le Traité de Rome (1957) concerne la construction européenne."], "info": "En 1979, l’URSS intervient militairement en Afghanistan. L’événement est perçu comme une expansion d’influence et provoque une réaction occidentale (condamnations, boycotts, réarmement).", "hint": "Indice : fin des années 1970; événement qui ravive fortement les tensions Est–Ouest."}, {"q": "Quel leader soviétique lance des réformes associées à la perestroïka et à la glasnost dans les années 1980?", "choices": ["Joseph Staline", "Nikita Khrouchtchev", "Mikhaïl Gorbatchev", "Vladimir Lénine"], "correct": 2, "fb": ["Non. Staline meurt en 1953.", "Non. Khrouchtchev est au pouvoir surtout dans les années 1950-1960.", "✅ Oui. Gorbatchev (arrivé en 1985) associe perestroïka (réformes) et glasnost (transparence).", "Non. Lénine est une figure de la Révolution russe (1917) et meurt en 1924."], "info": "À partir de 1985, Gorbatchev réforme l’URSS : perestroïka (restructuration) et glasnost (ouverture). Ces transformations, combinées à des pressions internes et externes, accélèrent les changements en Europe de l’Est et contribuent à la fin de la guerre froide.", "hint": "Indice : réformes soviétiques des années 1980 (ouverture/transparence + restructuration)."}, {"q": "Quel événement de 1989 symbolise l’effondrement du bloc de l’Est en Europe?", "choices": ["La signature de l’Acte de Québec", "La chute du mur de Berlin", "La crise de Suez", "La création de l’ONU"], "correct": 1, "fb": ["Non. Ce n’est pas un repère associé à la guerre froide en Europe.", "✅ Oui. La chute du mur de Berlin (novembre 1989) symbolise l’ouverture et les changements à l’Est.", "Non. Suez est en 1956.", "Non. L’ONU est créée en 1945."], "info": "En 1989, plusieurs régimes communistes d’Europe de l’Est s’effondrent. Le mur de Berlin, érigé en 1961, est ouvert puis démantelé. Cela mène à la réunification allemande (1990) et prépare la dissolution de l’URSS (1991).", "hint": "Indice : événement de novembre 1989 qui devient un symbole mondial de la fin de la division."}, {"q": "Quelle date est généralement associée à la fin de la guerre froide, avec la dissolution de l’URSS?", "choices": ["1956", "1962", "1980", "1991"], "correct": 3, "fb": ["Non. 1956 correspond notamment à la crise de Suez et à des tensions en Europe de l’Est.", "Non. 1962 correspond à la crise des missiles de Cuba.", "Non. 1980 est plutôt une période de reprise des tensions.", "✅ Oui. En 1991, l’URSS est dissoute, ce qui marque la fin de la guerre froide."], "info": "Même si des signes de transformation apparaissent dès 1989, la dissolution officielle de l’URSS en 1991 est souvent retenue comme repère de fin, car elle met fin au système bipolaire tel qu’il existait depuis 1945.", "hint": "Indice : la fin officielle est liée à la disparition de l’Union soviétique comme État."}, {"q": "Pendant la guerre froide, quel rôle le Canada cherche-t-il souvent à valoriser sur la scène internationale (en plus de ses alliances)?", "choices": ["Le maintien de la paix et la médiation", "La neutralité complète et le retrait de toute alliance", "L’isolement économique", "La colonisation de nouveaux territoires"], "correct": 0, "fb": ["✅ Oui. Le Canada met de l’avant la diplomatie et le maintien de la paix, notamment dans le contexte onusien.", "Non. Le Canada reste allié (OTAN, NORAD).", "Non. Le Canada est intégré à l’économie occidentale.", "Non. Ce n’est pas un objectif canadien de l’après‑1945."], "info": "Le Canada participe aux institutions internationales (ONU) et à des alliances (OTAN, NORAD) tout en valorisant une identité de médiateur et de « pays du milieu ». Le maintien de la paix se développe fortement au milieu du XXe siècle, notamment après la crise de Suez (1956).", "hint": "Pense au rôle international du Canada : alliances + diplomatie/ONU; quel rôle met-il de l’avant?"}, {"q": "Quel énoncé décrit le mieux une « course aux armements » pendant la guerre froide?", "choices": ["Une compétition sportive entre armées", "Une augmentation continue des arsenaux et technologies militaires pour dépasser l’adversaire", "Une réduction volontaire des armées partout", "Une interdiction totale de fabriquer des armes"], "correct": 1, "fb": ["Non. Ce n’est pas une compétition sportive.", "✅ Oui. Les deux camps développent bombes, missiles, sous-marins, défense aérienne, etc.", "Non. On observe plutôt une militarisation importante.", "Non. Il existe des traités, mais pas une interdiction totale."], "info": "La course aux armements est alimentée par la peur de l’avantage militaire de l’autre camp. Elle concerne les armes nucléaires, les missiles balistiques, les sous-marins nucléaires, les radars et la défense. Elle a des effets politiques, économiques et scientifiques.", "hint": "Pense au mot « course » : il s’agit d’une compétition technologique et militaire, pas d’un événement unique."}, {"q": "Quelle affirmation est la plus juste à propos des « guerres par procuration »?", "choices": ["Elles opposent toujours directement les armées américaine et soviétique", "Elles se déroulent uniquement en Europe", "Elles impliquent des conflits locaux où les superpuissances soutiennent des camps rivaux", "Elles n’impliquent jamais l’ONU"], "correct": 2, "fb": ["Non. Justement, l’affrontement direct est évité la plupart du temps.", "Non. Beaucoup ont lieu en Asie, Afrique ou Amérique latine.", "✅ Oui. Les superpuissances aident des alliés (armes, argent, conseillers, parfois troupes) dans des conflits locaux.", "Non. Certaines guerres impliquent l’ONU (ex. Corée)."], "info": "Les guerres par procuration sont des conflits où l’enjeu local devient un terrain de rivalité Est‑Ouest. Exemples : Corée (1950‑1953), Vietnam (années 1950‑1975), Afghanistan (à partir de 1979).", "hint": "Pense au terme « procuration » : des acteurs locaux se battent, mais des grandes puissances soutiennent derrière."}, {"q": "En quoi la propagande est-elle importante pendant la guerre froide?", "choices": ["Elle sert à convaincre les populations et alliés de la supériorité du modèle du camp (Ouest/Est)", "Elle remplace totalement l’armée", "Elle élimine les frontières", "Elle n’existe que dans le bloc de l’Est"], "correct": 0, "fb": ["✅ Oui. Les deux camps utilisent médias, cinéma, affiches et discours pour influencer opinions et alliances.", "Non. Les armées et les armes restent centrales.", "Non. Les frontières sont souvent renforcées (ex. mur de Berlin).", "Non. La propagande existe des deux côtés."], "info": "La guerre froide est aussi une guerre d’images et d’idées. Les deux camps cherchent à gagner l’opinion publique, à attirer des alliés, à justifier des dépenses militaires, et à présenter leur système comme le meilleur. Cela passe par la culture, les médias, l’éducation et parfois la censure.", "hint": "Pense à une « bataille des idées » : médias, affiches, discours, cinéma… quel est l’objectif?"}, {"q": "Quel lien explique le mieux pourquoi la modernisation du Québec (1945-1980) se déroule dans un contexte de guerre froide?", "choices": ["Parce que le Québec devient un État indépendant allié à l’URSS", "Parce que l’après‑guerre apporte croissance, consommation et transformations sociales, dans un Occident structuré par l’alliance avec les États-Unis", "Parce que la guerre froide interdit toute réforme sociale", "Parce que le Québec participe à la course spatiale en envoyant des astronautes sur la Lune"], "correct": 1, "fb": ["Non. Le Québec ne devient pas un État indépendant ni un allié de l’URSS.", "✅ Oui. La prospérité de l’après‑guerre et l’influence nord‑américaine s’inscrivent dans le cadre occidental de la guerre froide.", "Non. Au contraire, on observe de grandes réformes et transformations.", "Non. Le Canada a des contributions scientifiques, mais ce n’est pas l’élément central ici."], "info": "Dans l’Occident de l’après‑1945, la croissance économique (baby‑boom, consommation de masse, urbanisation) et l’influence culturelle américaine sont marquées. Au Québec, ces transformations s’articulent avec de grands changements sociaux et politiques (modernisation de l’État, laïcisation, expansion des services publics), tout en restant dans l’orbite occidentale.", "hint": "Relie l’après-guerre (croissance, influence américaine) à la modernisation du Québec : quel contexte occidental explique cela?"}];

  let quiz = JSON.parse(JSON.stringify(ORIGINAL));
  let order = [...Array(quiz.length).keys()];
  let idx = 0;

  let good = 0;          // correct du 1er coup
  let attemptsTotal = 0; // tentatives erronées

  let attempts = order.map(_ => ({ wrongChoices: [], seenCorrect: false })); // wrongChoices: [{idx:number, text:string}]

  const totalTxt = document.getElementById('totalTxt');
  const idxTxt = document.getElementById('idxTxt');
  const goodTxt = document.getElementById('goodTxt');
  const badTxt = document.getElementById('badTxt');

  const progressBar = document.getElementById('progressBar');

  const questionTxt = document.getElementById('questionTxt');
  const choicesEl = document.getElementById('choices');
  const feedbackBox = document.getElementById('feedbackBox');
  const infoBox = document.getElementById('infoBox');

  const passBtn = document.getElementById('passBtn');
  const hintBtn = document.getElementById('hintBtn');
  const hintText = document.getElementById('hintText');

  const restartBtn = document.getElementById('restartBtn');
  const shuffleBtn = document.getElementById('shuffleBtn');

  const panelBody = document.getElementById('panelBody');
  const resultPanel = document.getElementById('resultPanel');
  const summary = document.getElementById('summary');
  const badList = document.getElementById('badList');

  const enterFsBtn = document.getElementById('enterFsBtn');
  const exitFsBtn = document.getElementById('exitFsBtn');

  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function setTotal() { totalTxt.textContent = String(order.length); }

  function buildProgress() {
    progressBar.innerHTML = '';
    for (let i = 0; i < order.length; i++) {
      const seg = document.createElement('div');
      seg.className = 'seg' + (i === 0 ? ' current' : '');
      progressBar.appendChild(seg);
    }
  }

  function updateTop() {
    idxTxt.textContent = String(idx + 1);
    goodTxt.textContent = String(good);
    badTxt.textContent = String(attemptsTotal);

    const segs = [...progressBar.querySelectorAll('.seg')];
    segs.forEach((s, i) => s.classList.toggle('current', i === idx));
  }

  function resetFeedbackUI() {
    feedbackBox.style.display = 'none';
    feedbackBox.classList.remove('good','bad');
    feedbackBox.textContent = '';

    infoBox.style.display = 'none';
    infoBox.textContent = '';

    hintText.style.display = 'none';
    hintText.textContent = '';

    passBtn.style.display = 'none';
    passBtn.disabled = true;

    [...choicesEl.querySelectorAll('button.choice')].forEach(b => {
      b.disabled = false;
      b.classList.remove('correct','wrong');
      const tag = b.querySelector('.tag');
      if (tag) tag.remove();
    });
  }

  function makeHint(qObj) {
    return qObj.hint || "Indice : repère les mots-clés (date, lieu, acteurs) avant de choisir.";
  }

  function render() {
    setTotal();
    updateTop();
    resetFeedbackUI();

    const qIndex = order[idx];
    const qObj = quiz[qIndex];

    questionTxt.textContent = qObj.q;

    choicesEl.innerHTML = '';
    const idxs = shuffleArray([0,1,2,3]); // positions aléatoires
    idxs.forEach((origIdx, pos) => {
      const c = qObj.choices[origIdx];
      const btn = document.createElement('button');
      btn.className = 'choice';
      btn.type = 'button';
      btn.dataset.idx = String(origIdx); // conserve l'index original du choix
      btn.innerHTML = `<span class="sr-only">Choix </span><strong>${String.fromCharCode(65+pos)}.</strong> ${c}`;
      btn.addEventListener('click', () => onAnswer(origIdx));
      choicesEl.appendChild(btn);
    });

    hintBtn.onclick = () => {
      hintText.style.display = 'block';
      hintText.textContent = makeHint(qObj);
    };
  }

  function markChoice(choiceIndex, isCorrect) {
    const btn = choicesEl.querySelector(`button.choice[data-idx="${choiceIndex}"]`);
    if (!btn) return;

    btn.classList.add(isCorrect ? 'correct' : 'wrong');
    const tag = document.createElement('span');
    tag.className = 'tag';
    tag.textContent = isCorrect ? 'Bonne réponse' : 'À revoir';
    btn.appendChild(tag);
  }

  function disableAllChoices() {
    [...choicesEl.querySelectorAll('button.choice')].forEach(b => b.disabled = true);
  }

  function showFeedback(qObj, choiceIndex, isCorrect) {
    feedbackBox.style.display = 'block';
    feedbackBox.classList.toggle('good', isCorrect);
    feedbackBox.classList.toggle('bad', !isCorrect);
    feedbackBox.textContent = qObj.fb[choiceIndex];

    if (isCorrect) {
      infoBox.style.display = 'block';
      infoBox.textContent = qObj.info;
    }
  }

  function showPass() {
    passBtn.style.display = 'inline-block';
    passBtn.disabled = false;
  }

  function finalizeProgressForCurrentQuestion(qIndex) {
    const seg = progressBar.querySelectorAll('.seg')[idx];
    if (!seg) return;
    if (attempts[qIndex].wrongChoices.length === 0) seg.classList.add('good');
    else seg.classList.add('bad');
  }

  function onAnswer(choiceIndex) {
    const qIndex = order[idx];
    const qObj = quiz[qIndex];
    const isCorrect = (choiceIndex === qObj.correct);

    if (!isCorrect) {
      attemptsTotal += 1;
      attempts[qIndex].wrongChoices.push({ idx: choiceIndex, text: qObj.choices[choiceIndex] });

      showFeedback(qObj, choiceIndex, false);
      markChoice(choiceIndex, false);
      return;
    }

    if (!attempts[qIndex].seenCorrect) {
      if (attempts[qIndex].wrongChoices.length === 0) good += 1;
      attempts[qIndex].seenCorrect = true;
    }

    finalizeProgressForCurrentQuestion(qIndex);
    showFeedback(qObj, choiceIndex, true);
    markChoice(choiceIndex, true);
    disableAllChoices();
    showPass();
    updateTop();
  }

  passBtn.addEventListener('click', () => {
    idx += 1;
    if (idx >= order.length) finish();
    else render();
  });

  function finish() {
    panelBody.style.display = 'none';
    resultPanel.style.display = 'block';

    const total = order.length;
    const totalActions = good + attemptsTotal;
    const pct = totalActions > 0 ? Math.round((good / totalActions) * 100) : 0;

    summary.innerHTML = `
      <div class="pill"><span class="dot"></span><span>Questions : <strong>${total}</strong></span></div>
      <div class="pill"><span class="dot good"></span><span>Bonnes réponses : <strong>${good}</strong></span></div>
      <div class="pill"><span class="dot bad"></span><span>Tentatives : <strong>${attemptsTotal}</strong></span></div>
      <div class="pill"><span class="dot"></span><span>Taux (bonnes / actions) : <strong>${pct}%</strong></span></div>
    `;

    badList.innerHTML = '';
    const anyWrong = attempts.some(a => a.wrongChoices.length > 0);
    if (!anyWrong) {
      badList.innerHTML = `<div class="feedback good">✅ Aucune mauvaise tentative enregistrée. Solide révision!</div>`;
      return;
    }

    const header = document.createElement('div');
    header.className = 'feedback';
    header.innerHTML = `À la fin, voici une rétroaction <strong>pour chaque mauvaise réponse</strong> (chaque tentative) :`;
    badList.appendChild(header);

    order.forEach((qIndex, displayNum) => {
      const a = attempts[qIndex];
      if (!a.wrongChoices.length) return;

      const qObj = quiz[qIndex];
      const correctLetter = String.fromCharCode(65 + qObj.correct);
      const correctText = qObj.choices[qObj.correct];

      const det = document.createElement('details');
      det.open = false;

      const rows = a.wrongChoices.map((w, k) => {
        const ci = w.idx;
        const choiceText = w.text || qObj.choices[ci];
        const fb = qObj.fb[ci];
        return `
          <p><strong>Tentative ${k+1}</strong> : « ${choiceText} »<br/>
          <span style="color: rgba(238,246,255,0.92)">${fb}</span></p>
        `;
      }).join('');

      det.innerHTML = `
        <summary>Question ${displayNum+1} — ${a.wrongChoices.length} tentative(s) à revoir</summary>
        <p style="margin-top:8px;"><strong>Question :</strong> ${qObj.q}</p>
        ${rows}
        <p><strong>Bonne réponse :</strong> ${correctLetter}. ${correctText}</p>
        <p><strong>À retenir :</strong> ${qObj.info}</p>
      `;
      badList.appendChild(det);
    });
  }


  // ---- Rapport + envoi des résultats ----
  function buildReportText() {
    const total = order.length;
    const totalActions = good + attemptsTotal;
    const pct = totalActions > 0 ? Math.round((good / totalActions) * 100) : 0;

    let out = [];
    out.push("=== Rapport de quiz ===");
    out.push(`Quiz : ${document.title}`);
    out.push(`Date : ${new Date().toLocaleString()}`);
    out.push("");
    out.push(`Questions : ${total}`);
    out.push(`Bonnes réponses (1er coup) : ${good}`);
    out.push(`Tentatives (erreurs) : ${attemptsTotal}`);
    out.push(`Taux (bonnes / actions) : ${pct}%`);
    out.push("");

    const anyWrong = attempts.some(a => a.wrongChoices.length > 0);
    if (!anyWrong) {
      out.push("Aucune tentative erronée.");
      return out.join("\n");
    }

    out.push("---- Rétroactions des réponses manquées (par tentative) ----");
    out.push("");

    order.forEach((qIndex, displayNum) => {
      const a = attempts[qIndex];
      if (!a.wrongChoices.length) return;
      const qObj = quiz[qIndex];

      out.push(`Question ${displayNum+1} : ${qObj.q}`);
      a.wrongChoices.forEach((w, k) => {
        const choiceText = w.text || qObj.choices[w.idx];
        const fb = qObj.fb[w.idx];
        out.push(`  Tentative ${k+1} : "${choiceText}"`);
        out.push(`    Rétroaction : ${fb}`);
      });
      const correctText = qObj.choices[qObj.correct];
      out.push(`  Bonne réponse : ${correctText}`);
      out.push(`  À retenir : ${qObj.info}`);
      out.push("");
    });

    return out.join("\n");
  }

  function setSendStatus(msg, isOk=true) {
    const el = document.getElementById('sendStatus');
    el.style.display = 'block';
    el.style.color = isOk ? 'rgba(238,246,255,0.92)' : 'rgba(255,180,190,0.95)';
    el.textContent = msg;
  }

  async function sendResults() {
    const code = (document.getElementById('studentCode').value || '').trim();
    const teacher = (document.getElementById('teacherEmail').value || '').trim();
    const endpoint = (document.getElementById('endpointUrl').value || '').trim();

    if (!code) return setSendStatus("Entre ton code étudiant.", false);
    if (!teacher || !teacher.includes("@")) return setSendStatus("Entre un courriel d’enseignant valide.", false);

    const report = buildReportText();

    const payload = {
      studentCode: code,
      teacherEmail: teacher,
      quizTitle: document.title,
      goodFirstTry: good,
      wrongAttempts: attemptsTotal,
      reportText: report
    };

    try {
      setSendStatus("Envoi en cours…");
      const form = new URLSearchParams();
      // On envoie un seul champ 'payload' (JSON) pour éviter les problèmes CORS/preflight
      form.set('payload', JSON.stringify(payload));

      const res = await fetch(endpoint, {
        method: "POST",
        body: form
      });

      // Apps Script renvoie souvent du texte; on tente de lire JSON, sinon texte.
      let ok = res.ok;
      let msg = "Envoyé!";
      try {
        const data = await res.json();
        ok = !!data.ok;
        msg = data.message || (ok ? "Envoyé!" : "Échec de l’envoi.");
      } catch(e) {
        const t = await res.text();
        if (t) msg = t.slice(0, 250);
      }

      if (!ok) return setSendStatus("Échec de l’envoi : " + msg, false);
      setSendStatus("✅ Résultats envoyés à l’enseignant.");
    } catch (err) {
      setSendStatus("Échec de l’envoi (réseau ou URL invalide). Vérifie l’URL du service.", false);
    }
  }

  function copyReport() {
    const report = buildReportText();
    navigator.clipboard?.writeText(report).then(() => {
      setSendStatus("✅ Rapport copié dans le presse-papiers.");
    }).catch(() => {
      // fallback
      const ta = document.createElement('textarea');
      ta.value = report;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      ta.remove();
      setSendStatus("✅ Rapport copié dans le presse-papiers.");
    });
  }
  function restart(shuffle=false) {
    quiz = JSON.parse(JSON.stringify(ORIGINAL));
    order = [...Array(quiz.length).keys()];
    if (shuffle) order.sort(() => Math.random() - 0.5);

    idx = 0;
    good = 0;
    attemptsTotal = 0;
    attempts = order.map(_ => ({ wrongChoices: [], seenCorrect: false }));

    buildProgress();
    panelBody.style.display = 'grid';
    resultPanel.style.display = 'none';
    render();
  }

  restartBtn.addEventListener('click', () => restart(false));
  shuffleBtn.addEventListener('click', () => restart(true));

  async function enterFs() {
    try { await document.documentElement.requestFullscreen(); }
    catch(e) { alert("Plein écran non disponible sur cet appareil/navigateur."); }
  }
  async function exitFs() { try { await document.exitFullscreen(); } catch(e) {} }

  function syncFsButtons() {
    const isFs = !!document.fullscreenElement;
    enterFsBtn.style.display = isFs ? 'none' : 'inline-block';
    exitFsBtn.style.display = isFs ? 'inline-block' : 'none';
  }
  enterFsBtn.addEventListener('click', enterFs);
  exitFsBtn.addEventListener('click', exitFs);
  document.addEventListener('fullscreenchange', syncFsButtons);
  syncFsButtons();


  // Send results UI
  const sendBtn = document.getElementById('sendBtn');
  const copyReportBtn = document.getElementById('copyReportBtn');
  if (sendBtn) sendBtn.addEventListener('click', sendResults);
  if (copyReportBtn) copyReportBtn.addEventListener('click', copyReport);
  restart(false);
</script>
</body>
</html>
